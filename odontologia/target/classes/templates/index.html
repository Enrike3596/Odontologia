<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Clínica Odontológica</title>
    
    <!-- Bootstrap 5.3 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar {
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }
        .card-dashboard {
            transition: transform .2s, box-shadow .2s;
        }
        .card-dashboard:hover {
            transform: translateY(-5px);
            box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
        }
        .modal-xl {
            max-width: 90%;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd;
            border-color: #dee2e6 #dee2e6 #fff;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-heart-pulse-fill text-primary"></i>
                Clínica Odontológica
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-main">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar-main">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> Usuario
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><a class="dropdown-item" href="#">Mi Perfil</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">Cerrar Sesión</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mt-4">
        <div class="p-5 mb-4 bg-light rounded-3">
            <div class="container-fluid py-5">
                <h1 class="display-5 fw-bold">Bienvenido al Panel de Administración</h1>
                <p class="col-md-8 fs-4">Gestione pacientes, odontólogos y citas de forma centralizada.</p>
            </div>
        </div>

        <div class="row text-center">
            <!-- Pacientes -->
            <div class="col-md-4 mb-4">
                <div class="card card-dashboard h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <i class="bi bi-people-fill fs-1 text-primary"></i>
                        <h5 class="card-title mt-3">Pacientes</h5>
                        <p class="card-text">Administrar el registro de pacientes.</p>
                        <button class="btn btn-primary mt-auto" data-bs-toggle="modal" data-bs-target="#pacientesModal">Gestionar Pacientes</button>
                    </div>
                </div>
            </div>
            <!-- Odontólogos -->
            <div class="col-md-4 mb-4">
                <div class="card card-dashboard h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <i class="bi bi-person-badge fs-1 text-success"></i>
                        <h5 class="card-title mt-3">Odontólogos</h5>
                        <p class="card-text">Gestionar el personal odontológico.</p>
                        <button class="btn btn-success mt-auto" data-bs-toggle="modal" data-bs-target="#odontologosModal">Gestionar Odontólogos</button>
                    </div>
                </div>
            </div>
            <!-- Citas -->
            <div class="col-md-4 mb-4">
                <div class="card card-dashboard h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <i class="bi bi-calendar-check-fill fs-1 text-info"></i>
                        <h5 class="card-title mt-3">Citas</h5>
                        <p class="card-text">Agendar y administrar las citas.</p>
                        <button class="btn btn-info text-white mt-auto" data-bs-toggle="modal" data-bs-target="#citasModal">Gestionar Citas</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal Pacientes -->
    <div class="modal fade" id="pacientesModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Gestión de Pacientes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="pacientesTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="lista-pacientes-tab" data-bs-toggle="tab" data-bs-target="#lista-pacientes" type="button" role="tab">Listado</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="form-paciente-tab" data-bs-toggle="tab" data-bs-target="#form-paciente" type="button" role="tab">Formulario</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pacientesTabContent">
                        <div class="tab-pane fade show active" id="lista-pacientes" role="tabpanel">
                            <div class="p-3">
                                <button class="btn btn-success mb-3" onclick="handleNew('paciente')">
                                    <i class="bi bi-plus-circle"></i> Nuevo Paciente
                                </button>
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr><th>ID</th><th>Nombre</th><th>Apellido</th><th>DNI</th><th>Acciones</th></tr>
                                    </thead>
                                    <tbody id="pacientesTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="form-paciente" role="tabpanel">
                            <div class="p-3">
                                <h4 id="pacienteFormTitle">Nuevo Paciente</h4>
                                <form id="pacienteForm">
                                    <input type="hidden" id="pacienteId">
                                    <div class="row">
                                        <div class="col-md-6 mb-3"><input type="text" id="pacienteNombre" class="form-control" placeholder="Nombre" required></div>
                                        <div class="col-md-6 mb-3"><input type="text" id="pacienteApellido" class="form-control" placeholder="Apellido" required></div>
                                    </div>
                                    <div class="mb-3"><input type="text" id="pacienteDni" class="form-control" placeholder="DNI" required></div>
                                    <button type="submit" class="btn btn-primary">Guardar</button>
                                    <button type="button" class="btn btn-secondary" onclick="switchToTab('paciente', 'lista')">Cancelar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Odontólogos -->
    <div class="modal fade" id="odontologosModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Gestión de Odontólogos</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" id="odontologosTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="lista-odontologos-tab" data-bs-toggle="tab" data-bs-target="#lista-odontologos" type="button" role="tab">Listado</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="form-odontologo-tab" data-bs-toggle="tab" data-bs-target="#form-odontologo" type="button" role="tab">Formulario</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="odontologosTabContent">
                        <div class="tab-pane fade show active" id="lista-odontologos" role="tabpanel">
                            <div class="p-3">
                                <button class="btn btn-success mb-3" onclick="handleNew('odontologo')">
                                    <i class="bi bi-plus-circle"></i> Nuevo Odontólogo
                                </button>
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr><th>ID</th><th>Nombre</th><th>Apellido</th><th>Matrícula</th><th>Acciones</th></tr>
                                    </thead>
                                    <tbody id="odontologosTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="form-odontologo" role="tabpanel">
                            <div class="p-3">
                                <h4 id="odontologoFormTitle">Nuevo Odontólogo</h4>
                                <form id="odontologoForm">
                                    <input type="hidden" id="odontologoId">
                                    <div class="row">
                                        <div class="col-md-6 mb-3"><input type="text" id="odontologoNombre" class="form-control" placeholder="Nombre" required></div>
                                        <div class="col-md-6 mb-3"><input type="text" id="odontologoApellido" class="form-control" placeholder="Apellido" required></div>
                                    </div>
                                    <div class="mb-3"><input type="text" id="odontologoMatricula" class="form-control" placeholder="Matrícula" required></div>
                                    <button type="submit" class="btn btn-primary">Guardar</button>
                                    <button type="button" class="btn btn-secondary" onclick="switchToTab('odontologo', 'lista')">Cancelar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Citas -->
    <div class="modal fade" id="citasModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Gestión de Citas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                     <ul class="nav nav-tabs" id="citasTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="lista-citas-tab" data-bs-toggle="tab" data-bs-target="#lista-citas" type="button" role="tab">Listado</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="form-cita-tab" data-bs-toggle="tab" data-bs-target="#form-cita" type="button" role="tab">Formulario</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="citasTabContent">
                        <div class="tab-pane fade show active" id="lista-citas" role="tabpanel">
                            <div class="p-3">
                                <button class="btn btn-success mb-3" onclick="handleNew('cita')">
                                    <i class="bi bi-plus-circle"></i> Nueva Cita
                                </button>
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr><th>ID</th><th>Paciente</th><th>Odontólogo</th><th>Fecha y Hora</th><th>Estado</th><th>Acciones</th></tr>
                                    </thead>
                                    <tbody id="citasTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="form-cita" role="tabpanel">
                            <div class="p-3">
                                <h4 id="citaFormTitle">Nueva Cita</h4>
                                <form id="citaForm">
                                    <input type="hidden" id="citaId">
                                    <div class="mb-3">
                                        <label class="form-label">Paciente</label>
                                        <select id="citaPaciente" class="form-select" required></select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Odontólogo</label>
                                        <select id="citaOdontologo" class="form-select" required></select>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3"><input type="date" id="citaFecha" class="form-control" required></div>
                                        <div class="col-md-6 mb-3"><input type="time" id="citaHora" class="form-control" required></div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Guardar</button>
                                    <button type="button" class="btn btn-secondary" onclick="switchToTab('cita', 'lista')">Cancelar</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- DEMO DATA (simulates database) ---
        let demoPacientes = [
            { id: 1, nombre: 'Carlos', apellido: 'Sanchez', dni: '12345678A' },
            { id: 2, nombre: 'Ana', apellido: 'Gomez', dni: '87654321B' }
        ];
        let demoOdontologos = [
            { id: 1, nombre: 'Roberto', apellido: 'Fernandez', matricula: 'OD-1122' },
            { id: 2, nombre: 'Lucia', apellido: 'Mendez', matricula: 'OD-3344' }
        ];
        let demoCitas = [
            { id: 1, pacienteId: 1, odontologoId: 1, fecha: '2025-11-10', hora: '10:00', estado: 'Confirmada' },
            { id: 2, pacienteId: 2, odontologoId: 2, fecha: '2025-11-12', hora: '15:30', estado: 'Pendiente' }
        ];

        // --- RENDER FUNCTIONS ---
        function renderPacientes() {
            const tbody = document.getElementById('pacientesTableBody');
            tbody.innerHTML = demoPacientes.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.nombre}</td>
                    <td>${p.apellido}</td>
                    <td>${p.dni}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="handleEdit('paciente', ${p.id})"><i class="bi bi-pencil-square"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="handleDelete('paciente', ${p.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`).join('');
        }

        function renderOdontologos() {
            const tbody = document.getElementById('odontologosTableBody');
            tbody.innerHTML = demoOdontologos.map(o => `
                <tr>
                    <td>${o.id}</td>
                    <td>${o.nombre}</td>
                    <td>${o.apellido}</td>
                    <td>${o.matricula}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="handleEdit('odontologo', ${o.id})"><i class="bi bi-pencil-square"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="handleDelete('odontologo', ${o.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`).join('');
        }

        function renderCitas() {
            const tbody = document.getElementById('citasTableBody');
            tbody.innerHTML = demoCitas.map(c => {
                const paciente = demoPacientes.find(p => p.id === c.pacienteId);
                const odontologo = demoOdontologos.find(o => o.id === c.odontologoId);
                return `
                <tr>
                    <td>${c.id}</td>
                    <td>${paciente ? `${paciente.nombre} ${paciente.apellido}` : 'N/A'}</td>
                    <td>${odontologo ? `${odontologo.nombre} ${odontologo.apellido}` : 'N/A'}</td>
                    <td>${c.fecha} ${c.hora}</td>
                    <td><span class="badge bg-${c.estado === 'Confirmada' ? 'success' : 'warning'}">${c.estado}</span></td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="handleEdit('cita', ${c.id})"><i class="bi bi-pencil-square"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="handleDelete('cita', ${c.id})"><i class="bi bi-trash"></i></button>
                    </td>
                </tr>`;
            }).join('');
        }
        
        // --- TAB & FORM HANDLING ---
        function switchToTab(prefix, tabName) {
            const tab = document.querySelector(`#${tabName}-${prefix}-tab`);
            if (tab) {
                new bootstrap.Tab(tab).show();
            }
        }

        function handleNew(prefix) {
            document.getElementById(`${prefix}Form`).reset();
            document.getElementById(`${prefix}Id`).value = '';
            document.getElementById(`${prefix}FormTitle`).innerText = `Nuevo ${prefix.charAt(0).toUpperCase() + prefix.slice(1)}`;
            if (prefix === 'cita') populateCitaSelects();
            switchToTab(prefix, 'form');
        }

        function handleEdit(prefix, id) {
            const item = window[`demo${prefix.charAt(0).toUpperCase() + prefix.slice(1)}s`].find(i => i.id === id);
            if (!item) return;

            document.getElementById(`${prefix}Form`).reset();
            document.getElementById(`${prefix}Id`).value = item.id;
            document.getElementById(`${prefix}FormTitle`).innerText = `Editar ${prefix.charAt(0).toUpperCase() + prefix.slice(1)}`;

            if (prefix === 'paciente') {
                document.getElementById('pacienteNombre').value = item.nombre;
                document.getElementById('pacienteApellido').value = item.apellido;
                document.getElementById('pacienteDni').value = item.dni;
            } else if (prefix === 'odontologo') {
                document.getElementById('odontologoNombre').value = item.nombre;
                document.getElementById('odontologoApellido').value = item.apellido;
                document.getElementById('odontologoMatricula').value = item.matricula;
            } else if (prefix === 'cita') {
                populateCitaSelects(item.pacienteId, item.odontologoId);
                document.getElementById('citaFecha').value = item.fecha;
                document.getElementById('citaHora').value = item.hora;
            }
            
            switchToTab(prefix, 'form');
        }
        
        function handleDelete(prefix, id) {
            if (!confirm(`¿Está seguro de que desea eliminar este ${prefix}?`)) return;
            
            let dataArray = window[`demo${prefix.charAt(0).toUpperCase() + prefix.slice(1)}s`];
            const index = dataArray.findIndex(i => i.id === id);
            if (index > -1) {
                dataArray.splice(index, 1);
                window[`render${prefix.charAt(0).toUpperCase() + prefix.slice(1)}s`]();
            }
        }

        // --- FORM SUBMISSION ---
        document.getElementById('pacienteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('pacienteId').value;
            const newPaciente = {
                id: id ? parseInt(id) : Date.now(),
                nombre: document.getElementById('pacienteNombre').value,
                apellido: document.getElementById('pacienteApellido').value,
                dni: document.getElementById('pacienteDni').value
            };
            if (id) {
                const index = demoPacientes.findIndex(p => p.id === newPaciente.id);
                demoPacientes[index] = newPaciente;
            } else {
                demoPacientes.push(newPaciente);
            }
            renderPacientes();
            switchToTab('paciente', 'lista');
        });

        document.getElementById('odontologoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('odontologoId').value;
            const newOdontologo = {
                id: id ? parseInt(id) : Date.now(),
                nombre: document.getElementById('odontologoNombre').value,
                apellido: document.getElementById('odontologoApellido').value,
                matricula: document.getElementById('odontologoMatricula').value
            };
            if (id) {
                const index = demoOdontologos.findIndex(o => o.id === newOdontologo.id);
                demoOdontologos[index] = newOdontologo;
            } else {
                demoOdontologos.push(newOdontologo);
            }
            renderOdontologos();
            switchToTab('odontologo', 'lista');
        });
        
        document.getElementById('citaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('citaId').value;
            const newCita = {
                id: id ? parseInt(id) : Date.now(),
                pacienteId: parseInt(document.getElementById('citaPaciente').value),
                odontologoId: parseInt(document.getElementById('citaOdontologo').value),
                fecha: document.getElementById('citaFecha').value,
                hora: document.getElementById('citaHora').value,
                estado: id ? demoCitas.find(c=>c.id===parseInt(id)).estado : 'Pendiente'
            };
             if (id) {
                const index = demoCitas.findIndex(c => c.id === newCita.id);
                demoCitas[index] = newCita;
            } else {
                demoCitas.push(newCita);
            }
            renderCitas();
            switchToTab('cita', 'lista');
        });

        function populateCitaSelects(selectedPacienteId, selectedOdontologoId) {
            const pacienteSelect = document.getElementById('citaPaciente');
            pacienteSelect.innerHTML = demoPacientes.map(p => `<option value="${p.id}" ${p.id === selectedPacienteId ? 'selected' : ''}>${p.nombre} ${p.apellido}</option>`).join('');
            
            const odontologoSelect = document.getElementById('citaOdontologo');
            odontologoSelect.innerHTML = demoOdontologos.map(o => `<option value="${o.id}" ${o.id === selectedOdontologoId ? 'selected' : ''}>${o.nombre} ${o.apellido}</option>`).join('');
        }

        // --- INITIAL RENDER on modal show ---
        document.getElementById('pacientesModal').addEventListener('show.bs.modal', renderPacientes);
        document.getElementById('odontologosModal').addEventListener('show.bs.modal', renderOdontologos);
        document.getElementById('citasModal').addEventListener('show.bs.modal', () => {
            renderCitas();
            populateCitaSelects();
        });
    </script>

</body>
</html>